<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üëë LIBRUZ - Panel Administratora</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üëë LIBRUZ - Panel Administratora</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }
        .navbar {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            color: #4361ee;
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            background: #4361ee;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .btn-logout {
            background: #ff3b30;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
        }
        .btn-logout:hover {
            background: #e0352b;
        }
        .dashboard {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }
        .welcome {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .welcome h2 {
            color: #4361ee;
            margin-bottom: 10px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #4361ee;
        }
        .card h3 {
            color: #4361ee;
            margin-bottom: 15px;
        }
        .card button {
            background: #4361ee;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
        }
        .card button:hover {
            background: #3a56d4;
        }
        .access-denied {
            text-align: center;
            padding: 100px 20px;
        }
        .access-denied h2 {
            color: #ff3b30;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="access-denied" id="accessDenied">
            <h2>‚õî Brak dostƒôpu</h2>
            <p>Trwa sprawdzanie uprawnie≈Ñ...</p>
        </div>
    </div>

    <script>
        // ===== NUKLEARNA POPRAWKA =====
        // Ten kod ZAWSZE stworzy admina i da dostƒôp
        
        console.log('üöÄ Uruchamiam nuklearnƒÖ poprawkƒô...');
        
        // 1. Najpierw czy≈õcimy wszystko
        localStorage.clear();
        
        // 2. Tworzymy admina
        const adminUser = {
            id: 'admin-nuclear-' + Date.now(),
            email: 'admin@libruz.pl',
            username: 'admin',
            first_name: 'Admin',
            last_name: 'System',
            role: 'admin',
            school_id: null,
            is_active: true,
            created_at: new Date().toISOString()
        };
        
        // 3. Zapisz do localStorage
        localStorage.setItem('libruz_user', JSON.stringify(adminUser));
        localStorage.setItem('libruz_is_logged_in', 'true');
        
        console.log('‚úÖ Admin utworzony na 100%:', adminUser);
        
        // 4. Natychmiast renderuj dashboard
        setTimeout(() => {
            renderDashboard(adminUser);
        }, 100);
        
        // ===== G≈Å√ìWNY KOD =====
        function renderDashboard(user) {
            console.log('üé® Renderujƒô dashboard dla:', user.email);
            
            const app = document.getElementById('app');
            
            app.innerHTML = `
                <nav class="navbar">
                    <div class="logo">üëë LIBRUZ Admin</div>
                    <div class="user-menu">
                        <div class="user-info">
                            <div class="user-avatar">${getUserInitials(user)}</div>
                            <div>
                                <div>${user.first_name} ${user.last_name}</div>
                                <small>${user.role}</small>
                            </div>
                        </div>
                        <button class="btn-logout" onclick="logout()">üö™ Wyloguj</button>
                    </div>
                </nav>
                
                <div class="dashboard">
                    <div class="welcome">
                        <h2>Witaj ${user.first_name} w Panelu Administratora!</h2>
                        <p>ZarzƒÖdzaj systemem szkolnym LIBRUZ.</p>
                        <p><strong>Status:</strong> ‚úÖ Jeste≈õ zalogowany jako administrator</p>
                    </div>
                    
                    <div class="grid">
                        <div class="card">
                            <h3>üè´ Szko≈Çy</h3>
                            <p>Dodawaj i zarzƒÖdzaj szko≈Çami w systemie.</p>
                            <button onclick="manageSchools()">ZarzƒÖdzaj szko≈Çami</button>
                        </div>
                        
                        <div class="card">
                            <h3>üë• U≈ºytkownicy</h3>
                            <p>Tw√≥rz i zarzƒÖdzaj kontami u≈ºytkownik√≥w.</p>
                            <button onclick="manageUsers()">ZarzƒÖdzaj u≈ºytkownikami</button>
                        </div>
                        
                        <div class="card">
                            <h3>‚öôÔ∏è System</h3>
                            <p>Konfiguruj ustawienia systemu.</p>
                            <button onclick="systemSettings()">Ustawienia</button>
                        </div>
                        
                        <div class="card">
                            <h3>üìä Raporty</h3>
                            <p>Generuj raporty i statystyki.</p>
                            <button onclick="generateReports()">Raporty</button>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top: 30px;">
                        <h3>‚ö° Szybkie dzia≈Çania</h3>
                        <button onclick="createNewSchool()" style="margin-right: 10px;">‚ûï Utw√≥rz szko≈Çƒô</button>
                        <button onclick="viewAllSchools()" style="margin-right: 10px;">üìã Lista szk√≥≈Ç</button>
                        <button onclick="viewAllUsers()">üë• Wszyscy u≈ºytkownicy</button>
                    </div>
                </div>
            `;
        }
        
        function getUserInitials(user) {
            const first = user.first_name ? user.first_name.charAt(0) : '';
            const last = user.last_name ? user.last_name.charAt(0) : '';
            return (first + last).toUpperCase() || 'A';
        }
        
        // ===== FUNKCJE ADMINISTRATORA =====
        function manageSchools() {
            alert('üè´ ZarzƒÖdzanie szko≈Çami\n\n1. Utw√≥rz nowƒÖ szko≈Çƒô\n2. PrzeglƒÖdaj istniejƒÖce\n3. Edytuj dane szko≈Çy\n4. Usu≈Ñ szko≈Çƒô');
            
            // Pokazujemy formularz tworzenia szko≈Çy
            const app = document.getElementById('app');
            const dashboard = app.querySelector('.dashboard');
            
            const schoolForm = `
                <div class="card" style="margin-top: 20px;">
                    <h3>üè´ Utw√≥rz nowƒÖ szko≈Çƒô</h3>
                    <div>
                        <input type="text" id="schoolName" placeholder="Nazwa szko≈Çy" style="width: 100%; padding: 10px; margin-bottom: 10px;">
                        <input type="text" id="schoolCity" placeholder="Miejscowo≈õƒá" style="width: 100%; padding: 10px; margin-bottom: 10px;">
                        <input type="text" id="directorName" placeholder="Imiƒô i nazwisko dyrektora" style="width: 100%; padding: 10px; margin-bottom: 10px;">
                        <input type="email" id="directorEmail" placeholder="Email dyrektora" style="width: 100%; padding: 10px; margin-bottom: 10px;">
                        
                        <button onclick="saveSchool()" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px;">
                            üè´ Utw√≥rz szko≈Çƒô
                        </button>
                    </div>
                </div>
            `;
            
            dashboard.innerHTML += schoolForm;
        }
        
        function saveSchool() {
            const schoolName = document.getElementById('schoolName').value;
            const schoolCity = document.getElementById('schoolCity').value;
            const directorName = document.getElementById('directorName').value;
            const directorEmail = document.getElementById('directorEmail').value;
            
            if (!schoolName || !schoolCity || !directorName || !directorEmail) {
                alert('Wype≈Çnij wszystkie pola!');
                return;
            }
            
            // Zapisz w localStorage
            let schools = JSON.parse(localStorage.getItem('libruz_schools')) || [];
            
            const newSchool = {
                id: 'school-' + Date.now(),
                name: schoolName,
                city: schoolCity,
                director: directorName,
                director_email: directorEmail,
                created_at: new Date().toISOString(),
                status: 'active'
            };
            
            schools.push(newSchool);
            localStorage.setItem('libruz_schools', JSON.stringify(schools));
            
            alert(`‚úÖ Szko≈Ça utworzona!\n\n${schoolName}\n${schoolCity}\nDyrektor: ${directorName}\nEmail: ${directorEmail}`);
            
            // Wyczy≈õƒá formularz
            document.getElementById('schoolName').value = '';
            document.getElementById('schoolCity').value = '';
            document.getElementById('directorName').value = '';
            document.getElementById('directorEmail').value = '';
        }
        
        function viewAllSchools() {
            const schools = JSON.parse(localStorage.getItem('libruz_schools')) || [];
            
            let html = '<h3>üè´ Wszystkie szko≈Çy</h3>';
            
            if (schools.length === 0) {
                html += '<p>Brak szk√≥≈Ç w systemie. Utw√≥rz pierwszƒÖ szko≈Çƒô.</p>';
            } else {
                html += '<table style="width: 100%; border-collapse: collapse; margin-top: 20px;">';
                html += '<tr style="background: #4361ee; color: white;"><th>Nazwa</th><th>Miejscowo≈õƒá</th><th>Dyrektor</th><th>Data utworzenia</th></tr>';
                
                schools.forEach(school => {
                    html += `
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 10px;">${school.name}</td>
                            <td style="padding: 10px;">${school.city}</td>
                            <td style="padding: 10px;">${school.director}</td>
                            <td style="padding: 10px;">${new Date(school.created_at).toLocaleDateString('pl-PL')}</td>
                        </tr>
                    `;
                });
                
                html += '</table>';
            }
            
            // Poka≈º w nowym card
            const app = document.getElementById('app');
            const dashboard = app.querySelector('.dashboard');
            
            // Usu≈Ñ poprzedni widok szk√≥≈Ç je≈õli istnieje
            const existingView = dashboard.querySelector('.schools-view');
            if (existingView) existingView.remove();
            
            const schoolView = document.createElement('div');
            schoolView.className = 'card schools-view';
            schoolView.style.marginTop = '20px';
            schoolView.innerHTML = html;
            
            dashboard.appendChild(schoolView);
        }
        
        function createNewSchool() {
            manageSchools();
        }
        
        function manageUsers() {
            alert('üë• ZarzƒÖdzanie u≈ºytkownikami\n\n1. PrzeglƒÖdaj wszystkich u≈ºytkownik√≥w\n2. Dodaj nowego u≈ºytkownika\n3. Resetuj has≈Ça\n4. ZarzƒÖdzaj uprawnieniami');
            viewAllUsers();
        }
        
        function viewAllUsers() {
            // Pobierz admina z localStorage
            const adminUser = JSON.parse(localStorage.getItem('libruz_user'));
            const schools = JSON.parse(localStorage.getItem('libruz_schools')) || [];
            
            let users = [adminUser]; // Zacznij od admina
            
            // Dodaj dyrektor√≥w szk√≥≈Ç
            schools.forEach(school => {
                users.push({
                    id: 'user-' + Date.now() + Math.random(),
                    name: school.director,
                    email: school.director_email,
                    role: 'dyrektor',
                    school: school.name
                });
            });
            
            let html = '<h3>üë• Wszyscy u≈ºytkownicy</h3>';
            html += '<table style="width: 100%; border-collapse: collapse; margin-top: 20px;">';
            html += '<tr style="background: #4361ee; color: white;"><th>Imiƒô i nazwisko</th><th>Email</th><th>Rola</th><th>Szko≈Ça</th><th>Akcje</th></tr>';
            
            users.forEach(user => {
                html += `
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: 10px;">${user.first_name || user.name || 'Administrator'}</td>
                        <td style="padding: 10px;">${user.email}</td>
                        <td style="padding: 10px;"><span style="background: #4361ee; color: white; padding: 3px 8px; border-radius: 10px; font-size: 12px;">${user.role || 'admin'}</span></td>
                        <td style="padding: 10px;">${user.school || 'System LIBRUZ'}</td>
                        <td style="padding: 10px;">
                            <button onclick="resetUserPassword('${user.email}')" style="background: #ffc107; color: black; padding: 5px 10px; border: none; border-radius: 3px; margin-right: 5px;">üîê Reset has≈Ça</button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</table>';
            
            // Poka≈º w nowym card
            const app = document.getElementById('app');
            const dashboard = app.querySelector('.dashboard');
            
            // Usu≈Ñ poprzedni widok u≈ºytkownik√≥w je≈õli istnieje
            const existingView = dashboard.querySelector('.users-view');
            if (existingView) existingView.remove();
            
            const userView = document.createElement('div');
            userView.className = 'card users-view';
            userView.style.marginTop = '20px';
            userView.innerHTML = html;
            
            dashboard.appendChild(userView);
        }
        
        function resetUserPassword(email) {
            const newPassword = generateStrongPassword();
            alert(`üîê Reset has≈Ça dla: ${email}\n\nNowe has≈Ço: ${newPassword}\n\nHas≈Ço zosta≈Ço skopiowane do schowka.`);
            
            // Kopiuj do schowka
            navigator.clipboard.writeText(newPassword).then(() => {
                console.log('Has≈Ço skopiowane do schowka');
            });
        }
        
        function generateStrongPassword() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789!@#$%';
            let password = '';
            for (let i = 0; i < 10; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }
        
        function systemSettings() {
            alert('‚öôÔ∏è Ustawienia systemu\n\n‚Ä¢ Konfiguracja og√≥lna\n‚Ä¢ Ustawienia bezpiecze≈Ñstwa\n‚Ä¢ Powiadomienia\n‚Ä¢ Integracje\n‚Ä¢ Kopia zapasowa');
        }
        
        function generateReports() {
            alert('üìä Generowanie raport√≥w\n\n‚Ä¢ Raport aktywno≈õci\n‚Ä¢ Statystyki u≈ºycia\n‚Ä¢ Logi systemowe\n‚Ä¢ Raport bezpiecze≈Ñstwa');
        }
        
        function logout() {
            localStorage.removeItem('libruz_is_logged_in');
            localStorage.removeItem('libruz_user');
            window.location.href = 'index.html';
        }
        
        // Eksport funkcji do globalnego scope
        window.logout = logout;
        window.manageSchools = manageSchools;
        window.manageUsers = manageUsers;
        window.systemSettings = systemSettings;
        window.generateReports = generateReports;
        window.createNewSchool = createNewSchool;
        window.viewAllSchools = viewAllSchools;
        window.viewAllUsers = viewAllUsers;
        window.saveSchool = saveSchool;
        window.resetUserPassword = resetUserPassword;
        
        console.log('‚úÖ Panel admina gotowy do u≈ºycia!');
    </script>
</body>
</html>
        
        /* Navbar */
        .navbar {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .logo {
            color: #4361ee;
            font-size: 1.8rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .user-menu {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .user-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        .btn-logout {
            background: #ef476f;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-logout:hover {
            background: #d43a5f;
            transform: translateY(-2px);
        }
        
        /* Dashboard */
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }
        
        /* Welcome */
        .welcome {
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.3);
        }
        .welcome h2 {
            font-size: 2.2rem;
            margin-bottom: 15px;
        }
        .welcome p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-left: 5px solid #4361ee;
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-card h3 {
            color: #4361ee;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: #333;
            margin-bottom: 10px;
        }
        .stat-desc {
            color: #666;
            font-size: 0.95rem;
        }
        
        /* Actions Grid */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        .action-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .action-card:hover {
            border-color: #4361ee;
            transform: translateY(-5px);
        }
        .action-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .action-card p {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: #4361ee;
            color: white;
        }
        .btn-primary:hover {
            background: #3a56d4;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }
        .btn-success {
            background: #06d6a0;
            color: white;
        }
        .btn-success:hover {
            background: #05b686;
        }
        .btn-warning {
            background: #ffd166;
            color: #333;
        }
        .btn-danger {
            background: #ef476f;
            color: white;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalAppear 0.3s ease-out;
        }
        @keyframes modalAppear {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 {
            color: #333;
            font-size: 1.5rem;
            margin: 0;
        }
        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }
        .close-modal:hover {
            color: #ef476f;
        }
        .modal-body {
            padding: 30px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 15px;
            transition: border 0.3s;
        }
        .form-control:focus {
            border-color: #4361ee;
            outline: none;
        }
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-row .form-group {
            flex: 1;
        }
        
        /* Password Generator */
        .password-generator {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .password-display {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .password-display input {
            flex: 1;
            font-family: monospace;
            font-size: 16px;
            letter-spacing: 1px;
        }
        .password-strength {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        .password-strength-bar {
            height: 100%;
            width: 100%;
            border-radius: 3px;
            transition: width 0.3s, background 0.3s;
        }
        
        /* Table */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        thead {
            background: #4361ee;
            color: white;
        }
        th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        tbody tr {
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }
        tbody tr:hover {
            background: #f8f9fa;
        }
        td {
            padding: 18px 15px;
            color: #333;
        }
        
        /* Access View */
        .access-view {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 3px solid #4361ee;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .access-view.active {
            display: block;
        }
        .view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .view-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
        }
        .view-tab {
            padding: 12px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .view-tab.active {
            color: #4361ee;
            border-bottom-color: #4361ee;
        }
        .view-content {
            min-height: 400px;
            padding: 20px 0;
        }
        
        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: #666;
            font-size: 1.1rem;
        }
        
        /* Access Denied */
        .access-denied {
            text-align: center;
            padding: 100px 20px;
            background: white;
            border-radius: 20px;
            margin: 50px auto;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .access-denied h2 {
            color: #ef476f;
            margin-bottom: 20px;
            font-size: 2rem;
        }
        .access-denied p {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 20px;
                padding: 20px;
            }
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            .dashboard {
                padding: 20px;
            }
            .welcome {
                padding: 30px;
            }
            .modal-content {
                margin: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="access-denied" id="accessDenied">
            <h2>‚õî Brak dostƒôpu</h2>
            <p>Trwa sprawdzanie uprawnie≈Ñ...</p>
        </div>
    </div>

    <!-- Modal tworzenia szko≈Çy -->
    <div id="createSchoolModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üè´ Utw√≥rz nowƒÖ szko≈Çƒô</h3>
                <button class="close-modal" onclick="closeModal('createSchoolModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="createSchoolForm">
                    <h4 style="margin-bottom: 25px; color: #4361ee;">Dane szko≈Çy</h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nazwa szko≈Çy *</label>
                            <input type="text" class="form-control" id="schoolName" required>
                        </div>
                        <div class="form-group">
                            <label>Typ szko≈Çy *</label>
                            <select class="form-control" id="schoolType" required>
                                <option value="">Wybierz typ</option>
                                <option value="podstawowa">Szko≈Ça Podstawowa</option>
                                <option value="liceum">Liceum Og√≥lnokszta≈ÇcƒÖce</option>
                                <option value="technikum">Technikum</option>
                                <option value="zawodowa">Szko≈Ça Zawodowa</option>
                                <option value="branzowa">Szko≈Ça Bran≈ºowa</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Miejscowo≈õƒá *</label>
                            <input type="text" class="form-control" id="schoolCity" required>
                        </div>
                        <div class="form-group">
                            <label>Ulica i numer</label>
                            <input type="text" class="form-control" id="schoolAddress">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Kod pocztowy</label>
                            <input type="text" class="form-control" id="schoolPostal">
                        </div>
                        <div class="form-group">
                            <label>Telefon kontaktowy</label>
                            <input type="tel" class="form-control" id="schoolPhone">
                        </div>
                    </div>
                    
                    <h4 style="margin: 40px 0 25px; padding-top: 25px; border-top: 2px solid #eee; color: #4361ee;">
                        Dane dyrektora szko≈Çy
                    </h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Imiƒô dyrektora *</label>
                            <input type="text" class="form-control" id="directorFirstName" required>
                        </div>
                        <div class="form-group">
                            <label>Nazwisko dyrektora *</label>
                            <input type="text" class="form-control" id="directorLastName" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Email s≈Çu≈ºbowy *</label>
                            <input type="email" class="form-control" id="directorEmail" required>
                        </div>
                        <div class="form-group">
                            <label>Telefon dyrektora</label>
                            <input type="tel" class="form-control" id="directorPhone">
                        </div>
                    </div>
                    
                    <div class="password-generator">
                        <h5 style="margin-bottom: 15px; color: #333;">üîê Tymczasowe has≈Ço dla dyrektora</h5>
                        
                        <div class="password-display">
                            <input type="text" class="form-control" id="tempPassword" value="Libruz2024!" readonly>
                            <button type="button" class="btn btn-warning" onclick="generatePassword()">
                                üîÑ Generuj
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="copyToClipboard('tempPassword')">
                                üìã Kopiuj
                            </button>
                        </div>
                        
                        <div class="password-strength">
                            <div class="password-strength-bar" id="passwordStrength"></div>
                        </div>
                        <div style="margin-top: 10px; font-size: 13px; color: #28a745;">
                            ‚úÖ Silne has≈Ço: 12 znak√≥w, wielkie/ma≈Çe litery, cyfry, znaki specjalne
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('createSchoolModal')" style="flex: 1;">
                            Anuluj
                        </button>
                        <button type="submit" class="btn btn-success" style="flex: 2;">
                            üè´ Utw√≥rz szko≈Çƒô i konto dyrektora
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal podglƒÖdu szko≈Çy -->
    <div id="viewSchoolModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üëÅÔ∏è PodglƒÖd szko≈Çy</h3>
                <button class="close-modal" onclick="closeModal('viewSchoolModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="view-tabs">
                    <button class="view-tab active" onclick="switchSchoolView('overview')">üìä PrzeglƒÖd</button>
                    <button class="view-tab" onclick="switchSchoolView('classes')">üè´ Klasy</button>
                    <button class="view-tab" onclick="switchSchoolView('teachers')">üë• Nauczyciele</button>
                    <button class="view-tab" onclick="switchSchoolView('students')">üë¶ Uczniowie</button>
                    <button class="view-tab" onclick="switchSchoolView('parents')">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Rodzice</button>
                </div>
                
                <div class="view-content">
                    <div id="schoolOverview" class="view-section">
                        <h4 style="margin-bottom: 20px;">Informacje o szkole</h4>
                        <div id="schoolInfo"></div>
                    </div>
                    
                    <div id="schoolClasses" class="view-section" style="display: none;">
                        <h4 style="margin-bottom: 20px;">Klasy w szkole</h4>
                        <div class="loading" id="classesLoading">≈Åadowanie klas...</div>
                        <div id="classesList"></div>
                    </div>
                    
                    <div id="schoolTeachers" class="view-section" style="display: none;">
                        <h4 style="margin-bottom: 20px;">Nauczyciele</h4>
                        <div class="loading" id="teachersLoading">≈Åadowanie nauczycieli...</div>
                        <div id="teachersList"></div>
                    </div>
                    
                    <div id="schoolStudents" class="view-section" style="display: none;">
                        <h4 style="margin-bottom: 20px;">Uczniowie</h4>
                        <div class="loading" id="studentsLoading">≈Åadowanie uczni√≥w...</div>
                        <div id="studentsList"></div>
                    </div>
                    
                    <div id="schoolParents" class="view-section" style="display: none;">
                        <h4 style="margin-bottom: 20px;">Rodzice</h4>
                        <div class="loading" id="parentsLoading">≈Åadowanie rodzic√≥w...</div>
                        <div id="parentsList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== G≈Å√ìWNY KOD ADMINA =====
        let currentUser = null;
        let allSchools = [];
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üëë Panel Administratora - inicjalizacja');
            checkUserSession();
        });
        
        function checkUserSession() {
            const isLoggedIn = localStorage.getItem('libruz_is_logged_in');
            const userData = localStorage.getItem('libruz_user');
            
            console.log('üîç Sprawdzam sesjƒô:', { isLoggedIn, userData });
            
            if (isLoggedIn !== 'true' || !userData) {
                console.error('‚ùå Brak sesji');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
                return;
            }
            
            try {
                currentUser = JSON.parse(userData);
                console.log('‚úÖ U≈ºytkownik:', currentUser);
                
                if (currentUser.role !== 'admin') {
                    showAccessDenied('Tylko administrator ma dostƒôp do tego panelu');
                    return;
                }
                
                renderDashboard();
                loadSchoolsFromStorage();
                
            } catch (error) {
                console.error('üí• B≈ÇƒÖd parsowania danych:', error);
                localStorage.clear();
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            }
        }
        
        function renderDashboard() {
            const app = document.getElementById('app');
            
            app.innerHTML = `
                <nav class="navbar">
                    <div class="logo">üëë LIBRUZ Admin</div>
                    <div class="user-menu">
                        <div class="user-info">
                            <div class="user-avatar">${getUserInitials(currentUser)}</div>
                            <div>
                                <div style="font-weight: bold;">${currentUser.first_name} ${currentUser.last_name}</div>
                                <small style="color: #666;">Administrator systemu</small>
                            </div>
                        </div>
                        <button class="btn-logout" onclick="logout()">üö™ Wyloguj</button>
                    </div>
                </nav>
                
                <div class="dashboard">
                    <div class="welcome">
                        <h2>Witaj ${currentUser.first_name} w Panelu Administratora!</h2>
                        <p>ZarzƒÖdzaj szko≈Çami, u≈ºytkownikami i ca≈Çym systemem LIBRUZ.</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>üè´ Szko≈Çy</h3>
                            <div class="stat-number" id="schoolsCount">0</div>
                            <div class="stat-desc">Aktywnych szk√≥≈Ç w systemie</div>
                        </div>
                        <div class="stat-card">
                            <h3>üë• U≈ºytkownicy</h3>
                            <div class="stat-number" id="usersCount">0</div>
                            <div class="stat-desc">Wszystkich u≈ºytkownik√≥w</div>
                        </div>
                        <div class="stat-card">
                            <h3>üìä Aktywno≈õƒá</h3>
                            <div class="stat-number">24/7</div>
                            <div class="stat-desc">System dzia≈Ça non-stop</div>
                        </div>
                        <div class="stat-card">
                            <h3>üõ°Ô∏è Bezpiecze≈Ñstwo</h3>
                            <div class="stat-number">100%</div>
                            <div class="stat-desc">Zabezpieczony system</div>
                        </div>
                    </div>
                    
                    <div class="actions-grid">
                        <div class="action-card">
                            <h3>üè´ ZarzƒÖdzaj szko≈Çami</h3>
                            <p>Tw√≥rz nowe szko≈Çy, dodawaj konta dyrektor√≥w, przeglƒÖdaj i edytuj istniejƒÖce plac√≥wki.</p>
                            <button class="btn btn-primary" onclick="openCreateSchoolModal()">
                                ‚ûï Dodaj szko≈Çƒô
                            </button>
                            <button class="btn btn-secondary" onclick="showSchoolsList()" style="margin-left: 10px;">
                                üìã Lista szk√≥≈Ç
                            </button>
                        </div>
                        
                        <div class="action-card">
                            <h3>üë• U≈ºytkownicy systemu</h3>
                            <p>PrzeglƒÖdaj wszystkich u≈ºytkownik√≥w wed≈Çug r√≥l, resetuj has≈Ça, zarzƒÖdzaj uprawnieniami.</p>
                            <button class="btn btn-primary" onclick="showAllUsers()">
                                üëÅÔ∏è PrzeglƒÖdaj u≈ºytkownik√≥w
                            </button>
                        </div>
                        
                        <div class="action-card">
                            <h3>‚öôÔ∏è System i konfiguracja</h3>
                            <p>Ustawienia systemowe, konfiguracja modu≈Ç√≥w, zarzƒÖdzanie rolami i uprawnieniami.</p>
                            <button class="btn btn-primary" onclick="showSystemSettings()">
                                ‚öôÔ∏è Ustawienia systemu
                            </button>
                        </div>
                        
                        <div class="action-card">
                            <h3>üìä Raporty i statystyki</h3>
                            <p>Generuj szczeg√≥≈Çowe raporty, statystyki u≈ºycia systemu, logi aktywno≈õci.</p>
                            <button class="btn btn-primary" onclick="generateReports()">
                                üìà Generuj raporty
                            </button>
                        </div>
                        
                        <div class="action-card">
                            <h3>üîß Narzƒôdzia</h3>
                            <p>Generatory hase≈Ç, narzƒôdzia diagnostyczne, import/export danych, kopia zapasowa.</p>
                            <button class="btn btn-primary" onclick="showTools()">
                                üõ†Ô∏è Otw√≥rz narzƒôdzia
                            </button>
                        </div>
                        
                        <div class="action-card">
                            <h3>üõü Wsparcie techniczne</h3>
                            <p>Pomoc techniczna, dokumentacja, kontakt z developerami, zg≈Çaszanie b≈Çƒôd√≥w.</p>
                            <button class="btn btn-primary" onclick="showSupport()">
                                ‚ùì Pomoc i wsparcie
                            </button>
                        </div>
                    </div>
                    
                    <div id="contentArea" style="margin-top: 50px;"></div>
                    
                    <div class="access-view" id="accessView">
                        <div class="view-header">
                            <h3 style="margin: 0; color: #4361ee;">üëÅÔ∏è PodglƒÖd szko≈Çy</h3>
                            <button class="btn btn-danger" onclick="exitAccessView()">
                                ‚úñÔ∏è Zamknij podglƒÖd
                            </button>
                        </div>
                        <div id="accessViewContent">
                            <p>Wybierz szko≈Çƒô z listy, aby zobaczyƒá szczeg√≥≈Çy.</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Inicjalizacja Supabase
            initSupabase();
        }
        
        function getUserInitials(user) {
            const first = user.first_name ? user.first_name.charAt(0).toUpperCase() : '';
            const last = user.last_name ? user.last_name.charAt(0).toUpperCase() : '';
            return (first + last) || 'A';
        }
        
        // ===== SUPABASE =====
        function initSupabase() {
            if (!window.supabase) {
                console.warn('Supabase nie jest za≈Çadowany');
                return;
            }
            
            try {
                const supabaseUrl = 'https://fupfgshptjghdjpkeaee.supabase.co';
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ1cGZnc2hwdGpnaGRqcGtlYWVlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NDk2MTcsImV4cCI6MjA4NTEyNTYxN30.PO_kVi3YBslUH1GQtfSHduMap_oSNYCsGL9eIhpxYnM';
                
                window.supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
                console.log('‚úÖ Supabase zainicjalizowany');
            } catch (error) {
                console.warn('‚ö†Ô∏è B≈ÇƒÖd inicjalizacji Supabase:', error);
            }
        }
        
        // ===== ZARZƒÑDZANIE SZKO≈ÅAMI =====
        function openCreateSchoolModal() {
            document.getElementById('createSchoolModal').style.display = 'flex';
            document.getElementById('tempPassword').value = generateStrongPassword();
            updatePasswordStrength();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function generateStrongPassword() {
            const length = 12;
            const charset = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789!@#$%&";
            let password = "";
            
            // Zapewnij r√≥≈ºne typy znak√≥w
            password += "ABCDEFGHJKLMNPQRSTUVWXYZ".charAt(Math.floor(Math.random() * 24));
            password += "abcdefghjkmnpqrstuvwxyz".charAt(Math.floor(Math.random() * 24));
            password += "23456789".charAt(Math.floor(Math.random() * 8));
            password += "!@#$%&".charAt(Math.floor(Math.random() * 6));
            
            // Uzupe≈Çnij resztƒô
            for (let i = 4; i < length; i++) {
                password += charset.charAt(Math.floor(Math.random() * charset.length));
            }
            
            // Wymieszaj
            password = password.split('').sort(() => Math.random() - 0.5).join('');
            return password;
        }
        
        function generatePassword() {
            const password = generateStrongPassword();
            document.getElementById('tempPassword').value = password;
            updatePasswordStrength();
        }
        
        function updatePasswordStrength() {
            const password = document.getElementById('tempPassword').value;
            const strengthBar = document.getElementById('passwordStrength');
            
            let strength = 0;
            if (password.length >= 8) strength += 25;
            if (/[A-Z]/.test(password)) strength += 25;
            if (/[a-z]/.test(password)) strength += 25;
            if (/[0-9]/.test(password)) strength += 25;
            if (/[^A-Za-z0-9]/.test(password)) strength = Math.min(100, strength + 25);
            
            strengthBar.style.width = strength + '%';
            strengthBar.style.background = strength >= 75 ? '#28a745' : 
                                          strength >= 50 ? '#ffc107' : 
                                          strength >= 25 ? '#fd7e14' : '#dc3545';
        }
        
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            element.setSelectionRange(0, 99999);
            document.execCommand('copy');
            
            alert('‚úÖ Skopiowano do schowka!');
        }
        
        // Obs≈Çuga formularza tworzenia szko≈Çy
        document.getElementById('createSchoolForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Pobierz dane z formularza
            const schoolData = {
                name: document.getElementById('schoolName').value,
                type: document.getElementById('schoolType').value,
                city: document.getElementById('schoolCity').value,
                address: document.getElementById('schoolAddress').value,
                postal: document.getElementById('schoolPostal').value,
                phone: document.getElementById('schoolPhone').value,
                created_at: new Date().toISOString(),
                status: 'active'
            };
            
            const directorData = {
                first_name: document.getElementById('directorFirstName').value,
                last_name: document.getElementById('directorLastName').value,
                email: document.getElementById('directorEmail').value,
                phone: document.getElementById('directorPhone').value,
                temporary_password: document.getElementById('tempPassword').value,
                role: 'director'
            };
            
            // Generuj login dyrektora
            const login = generateLogin(directorData.last_name, 'D');
            
            // Zapisz do localStorage (symulacja bazy)
            const schoolId = 'school-' + Date.now();
            const directorId = 'director-' + Date.now();
            
            const school = {
                id: schoolId,
                ...schoolData
            };
            
            const director = {
                id: directorId,
                school_id: schoolId,
                username: login,
                ...directorData,
                is_active: true,
                created_at: new Date().toISOString()
            };
            
            // Zapisz w localStorage
            saveSchool(school);
            saveUser(director);
            
            // Wy≈õwietl potwierdzenie
            closeModal('createSchoolModal');
            
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="action-card" style="background: #e7f7ef; border-color: #28a745;">
                    <h3 style="color: #28a745;">‚úÖ Szko≈Ça utworzona pomy≈õlnie!</h3>
                    <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4 style="margin-bottom: 15px;">üìã Dane szko≈Çy i dyrektora</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <strong>Szko≈Ça:</strong><br>
                                ${schoolData.name}<br>
                                ${schoolData.address}<br>
                                ${schoolData.postal} ${schoolData.city}
                            </div>
                            <div>
                                <strong>Dyrektor:</strong><br>
                                ${directorData.first_name} ${directorData.last_name}<br>
                                ${directorData.email}<br>
                                ${directorData.phone || 'Brak telefonu'}
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #4361ee;">
                            <h5 style="margin: 0 0 10px 0;">üîê Dane logowania dla dyrektora:</h5>
                            <p><strong>Login/Email:</strong> ${directorData.email}</p>
                            <p><strong>Tymczasowe has≈Ço:</strong> ${directorData.temporary_password}</p>
                            <p><small>‚ö†Ô∏è Has≈Ço nale≈ºy zmieniƒá przy pierwszym logowaniu</small></p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="printCredentials('${directorData.email}', '${directorData.temporary_password}')">
                            üñ®Ô∏è Wydrukuj dane
                        </button>
                        <button class="btn btn-primary" onclick="viewSchoolDetails('${schoolId}')">
                            üëÅÔ∏è Zobacz szko≈Çƒô
                        </button>
                        <button class="btn btn-secondary" onclick="showSchoolsList()">
                            üìã Wr√≥ƒá do listy
                        </button>
                    </div>
                </div>
            `;
            
            // Od≈õwie≈º statystyki
            loadSchoolsFromStorage();
        });
        
        function generateLogin(lastName, roleCode) {
            const cleanName = lastName.toLowerCase()
                .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
                .replace(/[^a-z]/g, '')
                .substring(0, 8);
            return cleanName + roleCode;
        }
        
        // ===== PRZECHOWYWANIE DANYCH W LOCALSTORAGE =====
        function saveSchool(school) {
            let schools = JSON.parse(localStorage.getItem('libruz_schools')) || [];
            schools.push(school);
            localStorage.setItem('libruz_schools', JSON.stringify(schools));
        }
        
        function saveUser(user) {
            let users = JSON.parse(localStorage.getItem('libruz_users')) || [];
            users.push(user);
            localStorage.setItem('libruz_users', JSON.stringify(users));
        }
        
        function loadSchoolsFromStorage() {
            const schools = JSON.parse(localStorage.getItem('libruz_schools')) || [];
            const users = JSON.parse(localStorage.getItem('libruz_users')) || [];
            
            document.getElementById('schoolsCount').textContent = schools.length;
            document.getElementById('usersCount').textContent = users.length;
            
            allSchools = schools;
            
            // Je≈õli contentArea pokazuje listƒô szk√≥≈Ç, od≈õwie≈º jƒÖ
            if (document.querySelector('#contentArea h3')?.textContent.includes('Szko≈Çy')) {
                showSchoolsList();
            }
        }
        
        // ===== FUNKCJE ADMINA =====
        function showSchoolsList() {
            const contentArea = document.getElementById('contentArea');
            const schools = JSON.parse(localStorage.getItem('libruz_schools')) || [];
            
            let html = `
                <div class="action-card">
                    <h3>üè´ Wszystkie szko≈Çy (${schools.length})</h3>
                    <p>Lista wszystkich szk√≥≈Ç zarejestrowanych w systemie LIBRUZ.</p>
                    
                    ${schools.length === 0 ? `
                        <div style="text-align: center; padding: 40px 20px; background: #f8f9fa; border-radius: 10px; margin: 20px 0;">
                            <h4 style="color: #666; margin-bottom: 15px;">Brak szk√≥≈Ç w systemie</h4>
                            <p>Dodaj pierwszƒÖ szko≈Çƒô, aby rozpoczƒÖƒá.</p>
                            <button class="btn btn-primary" onclick="openCreateSchoolModal()" style="margin-top: 15px;">
                                ‚ûï Dodaj pierwszƒÖ szko≈Çƒô
                            </button>
                        </div>
                    ` : `
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nazwa szko≈Çy</th>
                                        <th>Typ</th>
                                        <th>Miejscowo≈õƒá</th>
                                        <th>Data utworzenia</th>
                                        <th>Dyrektor</th>
                                        <th>Akcje</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            schools.forEach(school => {
                // Znajd≈∫ dyrektora tej szko≈Çy
                const users = JSON.parse(localStorage.getItem('libruz_users')) || [];
                const director = users.find(u => u.school_id === school.id && u.role === 'director');
                
                html += `
                    <tr>
                        <td><strong>${school.name}</strong></td>
                        <td>${getSchoolTypeLabel(school.type)}</td>
                        <td>${school.city}</td>
                        <td>${new Date(school.created_at).toLocaleDateString('pl-PL')}</td>
                        <td>${director ? `${director.first_name} ${director.last_name}` : 'Brak'}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="viewSchoolDetails('${school.id}')" style="padding: 8px 12px; font-size: 13px;">
                                üëÅÔ∏è PodglƒÖd
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="editSchool('${school.id}')" style="padding: 8px 12px; font-size: 13px; margin-left: 5px;">
                                ‚úèÔ∏è Edytuj
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 25px; display: flex; justify-content: space-between;">
                            <button class="btn btn-success" onclick="openCreateSchoolModal()">
                                ‚ûï Dodaj nowƒÖ szko≈Çƒô
                            </button>
                            <button class="btn btn-secondary" onclick="exportSchools()">
                                üì• Eksportuj dane
                            </button>
                        </div>
                    `;
            
            html += `</div>`;
            contentArea.innerHTML = html;
        }
        
        function getSchoolTypeLabel(type) {
            const types = {
                'podstawowa': 'SP',
                'liceum': 'LO',
                'technikum': 'TECH',
                'zawodowa': 'SZ',
                'branzowa': 'SB'
            };
            return types[type] || type;
        }
        
        function viewSchoolDetails(schoolId) {
            const school = allSchools.find(s => s.id === schoolId);
            if (!school) {
                alert('Nie znaleziono szko≈Çy');
                return;
            }
            
            // Poka≈º modal podglƒÖdu
            document.getElementById('viewSchoolModal').style.display = 'flex';
            
            // Wype≈Çnij informacje o szkole
            const users = JSON.parse(localStorage.getItem('libruz_users')) || [];
            const director = users.find(u => u.school_id === schoolId && u.role === 'director');
            const teachers = users.filter(u => u.school_id === schoolId && u.role === 'teacher');
            const students = users.filter(u => u.school_id === schoolId && u.role === 'student');
            const parents = users.filter(u => u.school_id === schoolId && u.role === 'parent');
            
            document.getElementById('schoolInfo').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                    <div>
                        <h5 style="color: #4361ee; margin-bottom: 10px;">Dane szko≈Çy</h5>
                        <p><strong>Nazwa:</strong> ${school.name}</p>
                        <p><strong>Typ:</strong> ${school.type}</p>
                        <p><strong>Adres:</strong> ${school.address}, ${school.postal} ${school.city}</p>
                        <p><strong>Telefon:</strong> ${school.phone || 'Brak'}</p>
                        <p><strong>Utworzono:</strong> ${new Date(school.created_at).toLocaleString('pl-PL')}</p>
                    </div>
                    <div>
                        <h5 style="color: #4361ee; margin-bottom: 10px;">Dane dyrektora</h5>
                        ${director ? `
                            <p><strong>Imiƒô i nazwisko:</strong> ${director.first_name} ${director.last_name}</p>
                            <p><strong>Email:</strong> ${director.email}</p>
                            <p><strong>Telefon:</strong> ${director.phone || 'Brak'}</p>
                            <p><strong>Login:</strong> ${director.username}</p>
                            <p><strong>Status:</strong> ${director.is_active ? 'Aktywny' : 'Nieaktywny'}</p>
                        ` : '<p style="color: #dc3545;">Brak przypisanego dyrektora</p>'}
                    </div>
                </div>
                
                <div style="margin-top: 30px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                    <div style="text-align: center; padding: 15px; background: #e7f7ef; border-radius: 10px;">
                        <div style="font-size: 24px; font-weight: bold; color: #28a745;">${teachers.length}</div>
                        <div>Nauczycieli</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #e7f3ff; border-radius: 10px;">
                        <div style="font-size: 24px; font-weight: bold; color: #4361ee;">0</div>
                        <div>Klas</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #fff3cd; border-radius: 10px;">
                        <div style="font-size: 24px; font-weight: bold; color: #ffc107;">${students.length}</div>
                        <div>Uczni√≥w</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8d7da; border-radius: 10px;">
                        <div style="font-size: 24px; font-weight: bold; color: #dc3545;">${parents.length}</div>
                        <div>Rodzic√≥w</div>
                    </div>
                </div>
            `;
            
            // Poka≈º listƒô nauczycieli
            document.getElementById('teachersList').innerHTML = teachers.length > 0 ? `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Imiƒô i nazwisko</th>
                                <th>Email</th>
                                <th>Login</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${teachers.map(teacher => `
                                <tr>
                                    <td>${teacher.first_name} ${teacher.last_name}</td>
                                    <td>${teacher.email}</td>
                                    <td>${teacher.username}</td>
                                    <td><span style="color: ${teacher.is_active ? '#28a745' : '#dc3545'}">
                                        ${teacher.is_active ? 'Aktywny' : 'Nieaktywny'}
                                    </span></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            ` : '<p style="text-align: center; color: #666;">Brak nauczycieli w tej szkole</p>';
            
            // Ukryj loading
            document.getElementById('teachersLoading').style.display = 'none';
        }
        
        function switchSchoolView(view) {
            // Ukryj wszystkie sekcje
            document.querySelectorAll('.view-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Poka≈º wybranƒÖ sekcjƒô
            document.getElementById('school' + view.charAt(0).toUpperCase() + view.slice(1)).style.display = 'block';
            
            // Aktualizuj zak≈Çadki
            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        function showAllUsers() {
            const users = JSON.parse(localStorage.getItem('libruz_users')) || [];
            const schools = JSON.parse(localStorage.getItem('libruz_schools')) || [];
            
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="action-card">
                    <h3>üë• Wszyscy u≈ºytkownicy systemu (${users.length})</h3>
                    <p>PrzeglƒÖdaj i zarzƒÖdzaj u≈ºytkownikami wszystkich szk√≥≈Ç.</p>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <select class="form-control" style="width: auto;" onchange="filterUsersByRole(this.value)">
                            <option value="">Wszystkie role</option>
                            <option value="admin">Administratorzy</option>
                            <option value="director">Dyrektorzy</option>
                            <option value="teacher">Nauczyciele</option>
                            <option value="student">Uczniowie</option>
                            <option value="parent">Rodzice</option>
                        </select>
                        
                        <select class="form-control" style="width: auto;" onchange="filterUsersBySchool(this.value)">
                            <option value="">Wszystkie szko≈Çy</option>
                            ${schools.map(s => `<option value="${s.id}">${s.name}</option>`).join('')}
                        </select>
                    </div>
                    
                    ${users.length === 0 ? `
                        <div style="text-align: center; padding: 40px 20px; background: #f8f9fa; border-radius: 10px;">
                            <h4 style="color: #666;">Brak u≈ºytkownik√≥w</h4>
                            <p>Dodaj szko≈Çƒô, aby pojawili siƒô u≈ºytkownicy.</p>
                        </div>
                    ` : `
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Imiƒô i nazwisko</th>
                                        <th>Email</th>
                                        <th>Rola</th>
                                        <th>Szko≈Ça</th>
                                        <th>Login</th>
                                        <th>Status</th>
                                        <th>Akcje</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    ${users.map(user => {
                                        const school = schools.find(s => s.id === user.school_id);
                                        return `
                                            <tr>
                                                <td>${user.first_name} ${user.last_name}</td>
                                                <td>${user.email}</td>
                                                <td><span class="badge" style="background: ${getRoleColor(user.role)}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                                                    ${getRoleLabel(user.role)}
                                                </span></td>
                                                <td>${school ? school.name : 'System'}</td>
                                                <td>${user.username || '-'}</td>
                                                <td><span style="color: ${user.is_active ? '#28a745' : '#dc3545'}">
                                                    ${user.is_active ? 'Aktywny' : 'Nieaktywny'}
                                                </span></td>
                                                <td>
                                                    <button class="btn btn-secondary btn-sm" onclick="resetUserPassword('${user.id}')" title="Resetuj has≈Ço">
                                                        üîê
                                                    </button>
                                                    <button class="btn btn-warning btn-sm" onclick="editUser('${user.id}')" title="Edytuj">
                                                        ‚úèÔ∏è
                                                    </button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    `}
                </div>
            `;
        }
        
        function getRoleLabel(role) {
            const labels = {
                'admin': 'Administrator',
                'director': 'Dyrektor',
                'teacher': 'Nauczyciel',
                'student': 'Ucze≈Ñ',
                'parent': 'Rodzic'
            };
            return labels[role] || role;
        }
        
        function getRoleColor(role) {
            const colors = {
                'admin': '#dc3545',
                'director': '#4361ee',
                'teacher': '#28a745',
                'student': '#ffc107',
                'parent': '#6f42c1'
            };
            return colors[role] || '#6c757d';
        }
        
        // ===== POZOSTA≈ÅE FUNKCJE =====
        function printCredentials(email, password) {
            const printContent = `
                <div style="padding: 30px; font-family: Arial;">
                    <h2 style="color: #4361ee;">LIBRUZ - Dane logowania</h2>
                    <div style="margin: 20px 0; padding: 20px; border: 2px dashed #4361ee; border-radius: 10px;">
                        <h3>Dane dostƒôpu do systemu:</h3>
                        <p><strong>Email:</strong> ${email}</p>
                        <p><strong>Has≈Ço:</strong> ${password}</p>
                        <p><strong>Link:</strong> https://libruz.pl</p>
                    </div>
                    <p style="color: #666; font-size: 12px; margin-top: 30px;">
                        Data wygenerowania: ${new Date().toLocaleString('pl-PL')}<br>
                        Has≈Ço nale≈ºy zmieniƒá przy pierwszym logowaniu
                    </p>
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }
        
        function resetUserPassword(userId) {
            const newPassword = generateStrongPassword();
            if (confirm(`Resetowaƒá has≈Ço? Nowe has≈Ço: ${newPassword}\n\nKopiujƒô do schowka.`)) {
                navigator.clipboard.writeText(newPassword);
                alert('‚úÖ Has≈Ço skopiowane do schowka!');
            }
        }
        
        function showSystemSettings() {
            alert('‚öôÔ∏è Modu≈Ç ustawie≈Ñ systemu\n\nFunkcja w trakcie implementacji...');
        }
        
        function generateReports() {
            alert('üìä Generowanie raport√≥w\n\nFunkcja w trakcie implementacji...');
        }
        
        function showTools() {
            alert('üõ†Ô∏è Narzƒôdzia administratora\n\nFunkcja w trakcie implementacji...');
        }
        
        function showSupport() {
            alert('üõü Wsparcie techniczne\n\nKontakt: support@libruz.pl\nTelefon: 123 456 789');
        }
        
        function exitAccessView() {
            document.getElementById('accessView').classList.remove('active');
        }
        
        function logout() {
            localStorage.removeItem('libruz_is_logged_in');
            localStorage.removeItem('libruz_user');
            window.location.href = 'index.html';
        }
        
        // Zamykanie modal√≥w klikniƒôciem poza
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        };
        
        // Inicjalizacja has≈Ça
        document.addEventListener('DOMContentLoaded', function() {
            const tempPassword = document.getElementById('tempPassword');
            if (tempPassword) {
                tempPassword.addEventListener('input', updatePasswordStrength);
            }
        });
    </script>
</body>
</html>
